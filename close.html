<html>
 
<head>
    <title>Feedback Analysis</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="theme-color" content="#364cc9">
    <script src="jquery-3.4.1.min.js"></script>
    <script src="jquery-migrate-1.4.1.min.js"></script>    
    <script src="bootstrap.min.js"></script>
    <style>
        #nps label {
            float:left;
            width:10%;            
            /* margin:4px; */
            /* background-color:#EFEFEF; */
            /* border-radius:4px; */
            border:1px solid #78909c;
            overflow:auto;
            /* font-size: 0 !important; */
            /* margin: 0 !important; */
            /* padding: 0 !important;
            margin: auto; */
            margin-bottom:20px;
            color:#F7F7F7;
            font-weight: 550;
            text-shadow: white 1px 1px 2px;
            
        }

        .red {
            background-color:#ffbcaf;
        }

        .orange {
            background-color:#ffd180;
        }

        .yellow {
            background-color:#ffff8d;
        }
      
        .green1 {
            background-color:#cfff95;
        }

        .green2 {
            background-color:#98ee99;
        }



        #nps label span {
            text-align:center;
            font-size: 20px;
            padding:5x;
            display:block;
        }

        #nps label input {
            position:absolute;
            top:-20px;
            /* visibility: hidden; */
            display:none;
        }

        #nps input:checked + span {
            background-color:#288cff;
            color:#F7F7F7;
            text-shadow: blue 1px 1px 2px;
        }


        #nps .nps-btn {
            color:#333;
        }

        .hide-me[aria-expanded="true"] {display: none;}

        /* .add-feedback {
            background-color:#0277bd !important;
            color:#F7F7F7 !important;

        } */

        /* .bmh-colour {
        background-color: #005bab !important;
        } */

        hr.hr-style { 
        border: 0; 
        height: 1px; 
        background-image: -webkit-linear-gradient(left, #f0f0f0, #8c8b8b, #f0f0f0);
        background-image: -moz-linear-gradient(left, #f0f0f0, #8c8b8b, #f0f0f0);
        background-image: -ms-linear-gradient(left, #f0f0f0, #8c8b8b, #f0f0f0);
        background-image: -o-linear-gradient(left, #f0f0f0, #8c8b8b, #f0f0f0); 
    }

        dd {
            padding-bottom: 5px;
        }
        dd:after {
        content:"";
        background: -webkit-linear-gradient(left, #f0f0f0, #8c8b8b, #f0f0f0);    
        background: -moz-linear-gradient(left, #f0f0f0, #8c8b8b, #f0f0f0);
        background: -ms-linear-gradient(left, #f0f0f0, #8c8b8b, #f0f0f0);
        background: -o-linear-gradient(left, #f0f0f0, #8c8b8b, #f0f0f0); 
        display: block;
        height:1px;
        width: 90%;
        position: absolute;
        bottom: 0;
    }

        .rounded-heading {
        border-radius: 5px 15px;
        background: #007bff;
        color: white;
        padding: 10px; 
        text-align: center;

    }

    .bmh-blue-bg{
        background-color: #364cc9 !important;
        color: #ffffff !important;
    }

    .bmh-blue-txt{
        color: #2c3da3 !important;
    }

    .bmh-orange-bg{
        background-color: #F35724 !important;
        color: #ffffff !important;
    }

    .bmh-orange-txt{
        color: #F35724 !important;
    }

    .jumbotron {
    padding-bottom: 0.25rem !important;
    padding-top: 0.75rem !important;
    margin-bottom: 1rem !important;
    }

    @media (min-width: 576px) {
        .jumbotron {
            padding-bottom: 1rem !important;
        padding-top: 1.5rem !important;
        margin-bottom: 1.5rem !important;
        }
    }

    @media (min-width: 576px) {
        .logo {
        width: 200px !important;
        }
    }



    </style>
    <link rel="stylesheet" href="bootstrap.min.css">
</head>
 
<body>    
    
        <div class="jumbotron jumbotron-fluid bmh-blue-bg">
                    <div class="container text-center">
                        <img src="logo 200.png" class="img-fluid rounded logo" alt="Responsive image"  width = '150px'>
                        <h1 class="display-5 text-white pt-2">Feedback Analysis</h1>
                      <p class="text-white"><em>Powered by BMH Data Analytics Team</em></p>
                    </div>
        </div>
        <div class = 'container'>
            <!-- <h2>Close Feedback</h2> -->
            <div class ='row'>
                <div class="col-6">
                    <dl>
                        <dt class="col-sm-12 bmh-blue-txt">Name</dt>
                        <dd class="col-sm-12" id = 'name'>-</dd>
                        <dt class="col-sm-12 bmh-blue-txt">UHID</dt>
                        <dd class="col-sm-12" id = 'uhid'>-</dd>
                    </dl>
                </div>
                <div class="col-6">
                    <dl>
                        <dt class="col-sm-12 bmh-blue-txt">Ward</dt>
                        <dd class="col-sm-12" id = 'ward'>-</dd>
                        <dt class="col-sm-12 bmh-blue-txt">Room</dt>
                        <dd class="col-sm-12" id = 'room'>-</dd>
                    </dl>
                </div> 
            </div>
            <div class ='row'> 
                <div class="col-6"> 
                    <dl class="  ">
                        <dt class="col-sm-12 bmh-blue-txt">Feedback ID</dt>
                        <dd class="col-sm-12" id = 'feedback-id'>-</dd>
                    </dl>
                </div>
                <div class="col-6">
                    <dl class="  "> 
                        <dt class="col-sm-12 bmh-blue-txt">Feedback Type</dt>
                        <dd class="col-sm-12" id = 'feedback-type'>-</dd>
                    </dl>   
                </div>
            </div>                     
            <div class ='row'>  
                <div class="col-12">
                    <dl class=" ">   
                        <dt class="col-sm-12 bmh-blue-txt">Feedback Category</dt>
                        <dd class="col-sm-12" id = 'feedback-cat'>-</dd>       
                        <dt class="col-sm-12 bmh-blue-txt">Feedback Comments</dt>
                        <dd class="col-sm-12" id = 'feedack-comments'>-</dd>
                    </dl>  
                </div> 
            </div> 
            <!-- <ul class="list-group">
                    <li class="list-group-item font-weight-bold active">Name</li>
                    <li class="list-group-item">Bijoy Johnson</li>
                    <li class="list-group-item font-weight-bold active">UHID</li>
                    <li class="list-group-item">123456</li>
                    <li class="list-group-item">Vestibulum at eros</li>
            </ul> -->
            
            <!-- <button class="btn btn-primary hide-me btn-block" type="button" data-toggle="collapse" data-target="#feedback1" aria-expanded="false" aria-controls="collapseExample">
                    Close Feedback
            </button>  -->

            <!-- 
            <button class="btn btn-primary hide-me btn-block" id = 'reassign-button' type="button" data-toggle="collapse" data-target="#reassign-form" aria-expanded="false" aria-controls="collapseExample">
                    Re-assign Feedback
            </button>  -->

            <!-- <button class="btn btn-primary hide-me btn-block" id = 'reassign-button' type="button">
                    Call Patient
            </button>  -->
            <div id = "action-buttons">
                <button class="btn bmh-orange-bg hide-me btn-block" id = 'reassign-button' type="button">
                        Re-assign Feedback
                </button> 
                <button class="btn bmh-blue-bg hide-me btn-block" id = 'close-button' type="button">
                        Close Feedback
                </button> 
            </div>
            <!-- <button class="btn btn-primary hide-me btn-block" type="button" data-toggle="collapse" data-target="#feedback1" aria-expanded="false" aria-controls="collapseExample">
                    Mark as Voice of Customer
            </button>  -->

            <form name="reassign-form">    
                    <input type="hidden" name="form_name" value="reassign">
                    <input type="hidden" name="feedbackID" class="feedbackID" id = 'feedbackID' value=" ">
                    <div class = "collapse" id = 'reassign-form'>
                        <h4 class = 'bmh-orange-bg rounded-heading'>Re-assign Feedback</h4>
                        <div class = 'row'>
                            <div class="form-group col-12 col-md-6">
                                <label for="Reassign_cat" class = 'bmh-orange-txt font-weight-bold  '>Re-assign Category</label>
                                <select class="form-control Reassign_cat" id="Reassign_cat" name="Reassign_cat">
                                        <option class = 'Select'>Select Category</option>
                                        <option class = 'Admission'>Admission</option>
                                        <option class = 'Attendant'>Attendant services</option>
                                        <option class = 'Building'>Building and facilities</option>
                                        <option class = 'Cafeteria'>Cafeteria</option>
                                        <option class = 'Canteen'>Canteen</option>
                                        <option class = 'Care_coordination'>Care coordination</option>
                                        <option class = 'Dietary'>Dietary</option>
                                        <option class = 'Discharge'>Discharge</option>
                                        <option class = 'Doctors'>Doctors</option>
                                        <option class = 'ED'>ED</option>
                                        <option class = 'EEG, ENMG, Echo'>EEG, ENMG, Echo</option>
                                        <option class = 'Housekeeping'>Housekeeping</option>
                                        <option class = 'Insurance'>Insurance desk</option>
                                        <option class = 'Lab'>Lab</option>
                                        <option class = 'Nursing'>Nursing</option>
                                        <option class = 'Paramedical'>Paramedical services</option>
                                        <option class = 'Pharmacy'>Pharmacy</option>
                                        <option class = 'Radiology'>Radiology</option>
                                        <option class = 'Security'>Security</option>
                                        <option class = 'Others'>Others</option>
                                </select>
                            </div>  
                            <div class="form-group col-12 col-md-6">
                                <label for="Reassign_subcat" class = 'bmh-orange-txt font-weight-bold'>Re-assign Sub-category</label>
                                <select class="form-control Reassign_subcat" id="Reassign_subcat" name="Reassign_subcat">
                                        <option class = 'Select-sub'>Select Sub-category</option>
                                        <option class = 'Admission'>Delay in room allotment</option>
                                        <option class = 'Admission'>Staff behaviour</option>
                                        <option class = 'Attendant'>Staff behaviour</option>
                                        <option class = 'Attendant'>Timely services</option>
                                        <option class = 'Building'>Furniture and fixtures</option>
                                        <option class = 'Building'>Lift services</option>
                                        <option class = 'Building'>Parking</option>                            
                                        <option class = 'Building'>Signage</option>
                                        <option class = 'Building'>Ventilation and lighting</option>
                                        <option class = 'Cafeteria'>Ambience</option>
                                        <option class = 'Cafeteria'>Quality and cost</option>
                                        <option class = 'Cafeteria'>Staff behaviour</option>  
                                        <option class = 'Canteen'>Ambience</option>
                                        <option class = 'Canteen'>Quality and cost</option>
                                        <option class = 'Canteen'>Staff behaviour</option>
                                        <option class = 'Canteen'>Waiting time</option>
                                        <option class = 'Care_coordination'>IP CRE</option>
                                        <option class = 'Care_coordination'>Supervisors</option>
                                        <option class = 'Care_coordination'>Ward secretary</option>
                                        <option class = 'Dietary'>Quality and cost</option>
                                        <option class = 'Dietary'>Staff behaviour</option>
                                        <option class = 'Dietary'>Waiting time</option>
                                        <option class = 'Discharge'>Bill</option>
                                        <option class = 'Discharge'>Delay in discharge</option>
                                        <option class = 'Discharge'>Staff behaviour</option>
                                        <option class = 'Doctors'>Care and concern</option>
                                        <option class = 'Doctors'>Communication</option>
                                        <option class = 'ED'>Care and concern</option>
                                        <option class = 'ED'>Communication</option>
                                        <option class = 'ED'>Delay in services</option>
                                        <option class = 'EEG, ENMG, Echo'>Delay in services</option>
                                        <option class = 'EEG, ENMG, Echo'>Staff behaviour</option>
                                        <option class = 'Housekeeping'>Room cleanliness</option>
                                        <option class = 'Housekeeping'>Staff behaviour</option>
                                        <option class = 'Housekeeping'>Timely services</option>
                                        <option class = 'Housekeeping'>Toilet cleanliness</option>
                                        <option class = 'Insurance'>Delay in services</option>
                                        <option class = 'Insurance'>Staff behaviour</option>
                                        <option class = 'Lab'>Delay in reporting</option>
                                        <option class = 'Nursing'>Appearance and grooming</option>
                                        <option class = 'Nursing'>Care and concern</option>
                                        <option class = 'Nursing'>Timely services</option>
                                        <option class = 'Paramedical'>Nutrition and dietetics</option>
                                        <option class = 'Paramedical'>Physiotherapy</option>
                                        <option class = 'Paramedical'>Speech therapy and audiology</option>
                                        <option class = 'Pharmacy'>Delay in services</option>
                                        <option class = 'Pharmacy'>Medicine availability</option>
                                        <option class = 'Pharmacy'>Staff behaviour</option>
                                        <option class = 'Radiology'>Delay in reporting</option>
                                        <option class = 'Radiology'>Investigation delay</option>
                                        <option class = 'Radiology'>Staff behaviour</option>
                                        <option class = 'Security'>Staff behaviour</option>
                                        <option class = 'Others'>General</option>
                                        <option class = 'Others'>Hospital Management</option>
                                        <option class = 'Others'>Birth & Death registration</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="Reassign_reason" class = 'bmh-orange-txt font-weight-bold'>Re-assign Comments</label>
                            <textarea rows = "5" type="text" class="form-control" id="Reassign_reason" name="Reassign_reason"></textarea>                      
                        </div>   
                        <button type="submit" class="btn bmh-orange-bg btn-block">Submit</button>
                    </div>                     
            </form>

            <form name="close-form">    
                    <input type="hidden" name="form_name" value="close">
                    <input type="hidden" name="feedbackID" class="feedbackID" value=" ">
                    <div class = "collapse" id = 'close-form'>
                        <h4 class = 'bmh-blue-bg rounded-heading'>Close Feedback</h4>
                        <div class="form-group">
                            <label for="category1" class = 'bmh-blue-txt font-weight-bold'>Status</label>
                            <select class="form-control clStatus " id="clStatus" name="clStatus">
                            <option class = ' '>Select Status</option>
                            <option class = ' '>In-progress</option>
                            <option class = ' '>Resolved</option>
                            <option class = ' '>Voice of Customer</option>
                            </select>
                        </div>  
                        
                        <div class="form-group">
                            <label for="comments" class = 'bmh-blue-txt font-weight-bold'>Closure Comments</label>
                            <textarea rows = "5" type="text" class="form-control" id="comments" name="description1"></textarea>                      
                        </div>   
                        <h6 class = 'bmh-blue-txt'><em>Insta Replies (Beta)*</em></h6>
                        <div class = 'row'>
                            <div class = 'col-12 col-md-4'>
                                <button id='smart-reply1' class = 'btn btn-outline-primary btn-block mb-2'>Action taken.</button>
                            </div>
                            <div class = 'col-12 col-md-4'>
                                <button id='smart-reply2' class = 'btn btn-outline-primary btn-block mb-2'>Informed concerned staff.</button>
                            </div>
                            <div class = 'col-12 col-md-4'>
                                <button id='smart-reply3' class = 'btn btn-outline-primary btn-block mb-2'>Marked as VOC.</button>
                            </div>
                        </div>
                        <hr>
                        <button type="submit" id='submit-close' class="btn bmh-blue-bg btn-block">Submit</button>
                    </div>                     
            </form>

        <!-- Submission confirmation modal -->
        <div class="modal fade" id="submission" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 id = 'modal-heading' class="modal-title" id="exampleModalLongTitle">...</h5>
                    </div>
                    <div id = 'modal-text' class="modal-body">
                    ...
                    </div>
                    <div class="modal-footer justify-content-center">
                        <!-- <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button> -->
                        <button type="button" class="btn btn-block bmh-blue-bg" data-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>

    </div>
 

			

		</div>
    <script type="text/javascript">
        const url = "https://script.google.com/macros/s/AKfycbxfV2dMZjUx3975R6PMsTFUq9smjKTrsYt0RSAgZ32A_8v7sbk/exec";
        const form1 = document.forms.namedItem("reassign-form");
        const form2 = document.forms.namedItem("close-form");
        // console.log(form);
        form1.addEventListener("submit", function (e) {
            e.preventDefault();
            createMessage1();
        })
        form2.addEventListener("submit", function (e) {
            e.preventDefault();
            createMessage2();
        })
 
        function createMessage1() {
            console.log("submitted");
            const formData = new FormData(form1);
            console.log(formData);
            fetch(url, {
                method: "POST"
                , body: formData
            }).then(function (response) {
                return response.json()
            }).then(function (data) {
                console.log(data);
                let heading = "";
                let message = "";
                if (data.status === 200) {
                    heading = "Submitted successfully!";
                    message = "The feedback status has been updated.";
                    form1.reset();
                }
                else {
                    heading = "Submission failed!";
                    message = "Sorry, something went wrong.";
                }                
                $('#modal-heading').html(heading);
                $('#modal-text').html(message);                
                $('#submission').modal('show');
            })
        }

        function createMessage2() {
            console.log("submitted");
            const formData = new FormData(form2);
            console.log(formData);
            fetch(url, {
                method: "POST"
                , body: formData
            }).then(function (response) {
                return response.json()
            }).then(function (data) {
                console.log(data);
                let heading = "";
                let message = "";
                if (data.status === 200) {
                    heading = "Submitted successfully!";
                    message = "The feedback status has been updated.";
                    form2.reset();
                }
                else {
                    heading = "Submission failed!";
                    message = "Sorry, something went wrong.";
                }                
                $('#modal-heading').html(heading);
                $('#modal-text').html(message);                
                $('#submission').modal('show');
            })
        }

        //Get patient details from URL parameters
            var params = location.href.split("?")[1];
            var name = params.split('&')[0].replace(/%20/g, " ");
            var uhid = params.split('&')[1].replace(/%20/g, " ");
            var ward = params.split('&')[2].replace(/%20/g, " ");
            var room = params.split('&')[3].replace(/%20/g, " ");
            var feedback_id = params.split('&')[4].replace(/%20/g, " ");
            var feedback_type = params.split('&')[5].replace(/%20/g, " ");
            var feedback_cat = params.split('&')[6].replace(/%20/g, " ");
            var feedback_subcat = params.split('&')[7].replace(/%20/g, " ");
            var feedack_comments = params.split('&')[8].replace(/%20/g, " ");
            


        //Pre-fill form based on patient data
            document.getElementById('name').innerText = name;
            document.getElementById('uhid').innerText = uhid;
            document.getElementById('ward').innerText = ward;
            document.getElementById('room').innerText = room;
            document.getElementById('feedback-id').innerText = feedback_id;
            document.getElementById('feedback-type').innerText = feedback_type;
            document.getElementById('feedback-cat').innerText = feedback_cat + ' - ' + feedback_subcat;
            //document.getElementById('feedback-subcat').innerText = feedback_subcat;
            document.getElementById('feedack-comments').innerText = feedack_comments;
            //Set feedback ID as hidden field in re-assign and close forms
            $(".feedbackID").val(feedback_id);

        //Update sub-category based on category selected
        //Based on http://jsfiddle.net/Wa4ZF/9/ and https://stackoverflow.com/questions/20477406/filter-category-select-drop-down-based-on-another-drop-down-option
        //Feedback 1
        $(document).ready(function () {    
            var allOptions = $('#Reassign_subcat option')
            $('#Reassign_cat').change(function () {
                $('#Reassign_subcat option').remove()
                var classN = $('#Reassign_cat option:selected').prop('class');
                var opts = allOptions.filter('.' + classN);
                $.each(opts, function (i, j) {
                    $(j).appendTo('#Reassign_subcat');
                });
            });
        });




        $(document).ready(function(){
            $("#reassign-button").click(function(){
                $("#reassign-form").fadeToggle();
                $("#action-buttons").hide();
                $('html, body').animate({scrollTop:$(document).height()}, 'slow');
            });
        });

        $(document).ready(function(){
            $("#close-button").click(function(){
                $("#close-form").fadeToggle();
                $("#action-buttons").hide();
                $('html, body').animate({scrollTop:$(document).height()}, 'slow');
            });
        });

        $(document).ready(function(){
            $("#smart-reply1").click(function(){
                $("#clStatus").val("Resolved");
                $("#submit-close").fadeTo("fast", 0.1);
                $("#smart-reply2").fadeTo("fast", 0.2);
                $("#smart-reply3").fadeTo("fast", 0.2);
                var smart_message =  $("#smart-reply1").text();
                document.getElementById('comments').innerText = smart_message;                
            });
        });

        $(document).ready(function(){
            $("#smart-reply2").click(function(){
                $("#clStatus").val("Resolved");
                $("#submit-close").fadeTo("fast", 0.1);
                $("#smart-reply1").fadeTo("fast", 0.2);
                $("#smart-reply3").fadeTo("fast", 0.2);
                var smart_message =  $("#smart-reply2").text();
                document.getElementById('comments').innerText = smart_message;                
            });
        });

        $(document).ready(function(){
            $("#smart-reply3").click(function(){
                $("#clStatus").val("Voice of Customer");
                $("#submit-close").fadeTo("fast", 0.1);
                $("#smart-reply1").fadeTo("fast", 0.2);
                $("#smart-reply2").fadeTo("fast", 0.2);
                var smart_message =  $("#smart-reply3").text();
                document.getElementById('comments').innerText = smart_message;                
            });
        });
        
        

 
        </script>
</body>
 
</html>